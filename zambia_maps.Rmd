---
title: "Zambia Administrative Boundaries and Population"
output: html_document
---

```{r setup, message=FALSE}
library(tidyverse)
library(sf)
library(readxl)
library(here)
library(janitor)
library(viridis)
```

## Load Data

```{r, include=FALSE}
# Administrative boundries

adm0 <- st_read("shapefiles/administrative_boundaries/zmb_admbnda_adm0_dmmu_20201124.shp") %>% clean_names()
adm1 <- st_read("shapefiles/administrative_boundaries/zmb_admbnda_adm1_dmmu_20201124.shp") %>% clean_names()
adm2 <- st_read("shapefiles/administrative_boundaries/zmb_admbnda_adm2_dmmu_20201124.shp") %>% clean_names()
# admbndl <- st_read("shapefiles/administrative_boundaries/zmb_admbndl_admALL_dmmu_itos_20201124.shp") %>% clean_names()
# admbndp <- st_read("shapefiles/administrative_boundaries/zmb_admbndp_admALL_dmmu_itos_20201124.shp") %>% clean_names()

# Population data
pop_adm1 <- read_excel("data/zmb_admpop_2020.xlsx", sheet = "zmb_admpop_adm1_2020") %>% clean_names()
pop_adm2 <- read_excel("data/zmb_admpop_2020.xlsx", sheet = "zmb_admpop_adm2_2020") %>% clean_names()

# Health facilities https://data.grid3.org/datasets/GRID3::nsdi-zambia-operational-health-facility-layer-version-01-beta/about
health_pts <- st_read("shapefiles/health_facilities/nsdi/NSDI_Zambia_Operational_Health_Facility_Layer%2C_Version_01_(Beta).shp") %>% clean_names()

```

## Export list of health facilities
```{r}
write_csv(health_pts, "health_pts.csv")
```

## Join Population to Boundaries
```{r}
adm1_pop <- adm1 %>% left_join(pop_adm1, by = c("adm1_pcode" = "adm1_code"))
```

## Choropleth Map of Population and health points (2020)

```{r choropleth1}
ggplot() +
  geom_sf(data = adm1_pop, aes(fill = both_totl), color = "grey40", linewidth = 0.4) +
  geom_sf(data = health_pts, color = "red", size = 0.7, alpha = 0.7) +
  scale_fill_viridis_c(option = "Blues", direction = -1, name = "Population 2020") +
  labs(title = "Population and Health Facilities by Province (2020)") +
  theme_minimal()
```
## Combined Province and District Layers with Health Facilities

```{r choropleth3}
ggplot() +
  geom_sf(data = adm2, fill = NA, color = "grey60", linewidth = 0.3) +   # District boundaries
  geom_sf(data = adm1, fill = NA, color = "black", linewidth = 0.8) +    # Province boundaries
  geom_sf_text(data = adm1, aes(label = adm1_en), size = 3, fontface = "bold") +
  geom_sf(data = health_pts, color = "red", size = 1, alpha = 0.3) +
  labs(title = "Health Facilities over Administrative Boundaries") +
  theme_minimal()
```

## Spatial Join

```{r}
health_pts_adm1 <- health_pts %>% st_join(adm1, join = st_intersects)
health_pts_adm2 <- health_pts %>% st_join(adm2, join = st_intersects)
```

